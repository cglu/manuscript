<!DOCTYPE html><html><head><title>Laravel的服务提供者之源码阅读</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style>
.note-content  {font-family: 'Helvetica Neue', Arial, 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Song, sans-serif;}

</style></head><body><div id='preview-contents' class='note-content'>
                        <div id="wmd-preview" class="preview-content"></div>
                    <div id="wmd-preview-section-11135" class="wmd-preview-section preview-content">

<p></p>

</div><div id="wmd-preview-section-11136" class="wmd-preview-section preview-content">

<h2 id="laravel的服务提供者之源码阅读">Laravel的服务提供者之源码阅读</h2>

<blockquote>
  <p>今天休息，花了一上午时间读了下Laravel服务提供者这一条线上的代码。阅读代码之前需要先了解IOC容器和依赖注入。否则就不容易看懂了。这里放个传送门<a href="https://www.insp.top/learn-laravel-container" target="_blank">laravel 学习笔记 —— 神奇的服务容器</a>。这里简单说下IOC和依赖注入。<strong>何为依赖注入呢?就是把类内部的依赖关系、通过诸如<code>setter</code>,<code>__construct</code>这样的方法把依赖从外部进行注入。那么何为IOC?IOC可以理解成是一个对象容器，对象的依赖关系，通过IOC进行自动注入。</strong></p>
</blockquote>

</div><div id="wmd-preview-section-11137" class="wmd-preview-section preview-content">

<h4 id="第一步我们先使用下laravel提供者">第一步:我们先使用下Laravel提供者</h4>

<blockquote>
  <p>如果不了解服务提供者，最好先阅读下官方相关的文档。这样，在看这篇文章效果可能会好一些。解析来我们开始创建一个属于我们的服务器者。</p>
</blockquote>

<p>1.在<code>app/Libraries</code>目录下创建<code>MyClass.php</code>文件。打开文件，随便放一些测试代码:</p>

</div><div id="wmd-preview-section-11138" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="hljs xquery"><span class="hljs-comment line-number">1.</span>&lt;?php<br><span class="hljs-comment line-number">2.</span><span class="hljs-keyword">namespace</span> App\Libraries;<br><span class="hljs-comment line-number">3.</span><br><span class="hljs-comment line-number">4.</span>class MyClass<br><span class="hljs-comment line-number">5.</span>{<br><span class="hljs-comment line-number">6.</span>private <span class="hljs-variable">$app</span>;<br><span class="hljs-comment line-number">7.</span><br><span class="hljs-comment line-number">8.</span>public function __construct(<span class="hljs-variable">$app</span>)<br><span class="hljs-comment line-number">9.</span>{<br><span class="hljs-comment line-number">10.</span><span class="hljs-variable">$this-</span>&gt;app = <span class="hljs-variable">$app</span>;<br><span class="hljs-comment line-number">11.</span>}<br><span class="hljs-comment line-number">12.</span>public function test()<br><span class="hljs-comment line-number">13.</span>{<br><span class="hljs-comment line-number">14.</span>// var_dump(<span class="hljs-variable">$this-</span>&gt;app);<br><span class="hljs-comment line-number">15.</span>return <span class="hljs-string">"我是自定义test函数&lt;/br&gt;"</span>;<br><span class="hljs-comment line-number">16.</span>}<br><span class="hljs-comment line-number">17.</span>}<br></code></pre>

<p>OK,一个自定义的类就完成了。可以被composer识别自动加载。为什么？参考我之前写的<a href="http://luhu.in/article/45" target="_blank">Laravel框架中添加自定义类和函数</a>一文。 <br>
2.在<code>app</code>目录下运行一下命令，创建<code>MyClassServiceProvider.php</code>文件。</p>

</div><div id="wmd-preview-section-11139" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="hljs css"><span class="hljs-comment line-number">1.</span><span class="hljs-tag">php</span> <span class="hljs-tag">artisan</span> <span class="hljs-tag">make</span><span class="hljs-pseudo">:provider</span> <span class="hljs-tag">MyClassServiceProvider</span><br></code></pre>

<p>创建完成，会在<code>app/Providers</code>目录下找到该文件，打开之后找到<code>register</code>函数。开始注册我们之前定义的<code>MyClass</code>类.</p>

</div><div id="wmd-preview-section-11140" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="hljs xquery"><span class="hljs-comment line-number">1.</span>public <span class="hljs-keyword">function</span> register()<br><span class="hljs-comment line-number">2.</span>{<br><span class="hljs-comment line-number">3.</span>        //注册<br><span class="hljs-comment line-number">4.</span><span class="hljs-variable">$this-</span>&gt;app-&gt;bind(<span class="hljs-string">'App\Libraries\MyClass'</span>, function (<span class="hljs-variable">$app</span>) {<br><span class="hljs-comment line-number">5.</span>return new MyClass(<span class="hljs-variable">$app</span>);<br><span class="hljs-comment line-number">6.</span><br><span class="hljs-comment line-number">7.</span>}); <br><span class="hljs-comment line-number">8.</span>}<br></code></pre>

<p>至此，编码就结束了，还剩最后一步。 <br>
3.打开<code>config/app.php</code>文件，找到<code>providers</code>数组，在最后添加:</p>

</div><div id="wmd-preview-section-11141" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="hljs coffeescript"><span class="hljs-comment line-number">1.</span> App\Providers\<span class="hljs-attribute">MyClassServiceProvider</span>::<span class="hljs-class"><span class="hljs-keyword">class</span></span><br></code></pre>

<p>一切准备就绪，开始测试吧。 <br>
4.这里我直接把测试代码写在了<code>app/Http/routes.php</code>文件里</p>

</div><div id="wmd-preview-section-11142" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="hljs xquery"><span class="hljs-comment line-number">1.</span>Route::get(<span class="hljs-string">'/'</span>, <span class="hljs-keyword">function</span> () {<br><span class="hljs-comment line-number">2.</span>    //创建MyClass对象<br><span class="hljs-comment line-number">3.</span>    <span class="hljs-variable">$myClass</span> = app()-&gt;make(<span class="hljs-string">'App\Libraries\MyClass'</span>);<br><span class="hljs-comment line-number">4.</span>    echo <span class="hljs-variable">$myClass-</span>&gt;test();<br><span class="hljs-comment line-number">5.</span>});<br></code></pre>

<p>通过，一切正常+愉快。<strong>但是如果文章到这里结束了，挺没意思的。接下来我们去分析服务提供者这部分的源码，捎带还会有一部分Laravel启动过程的内容</strong></p>

</div><div id="wmd-preview-section-11143" class="wmd-preview-section preview-content">

<h4 id="第二步阅读源码">第二步:阅读源码</h4>

<p>我们想理解服务器提供者是怎么被实现的？就要去阅读Laravel对IOC容器的实现。Laravel对IOC容器的实现是在<code>vendor/laravel/framework/src/Illuminate/Container/Container.php</code>这个文件里。其实整个Appliction就是一个IOC容器，这是Laravel的核心部分。我们直接打开它。这里我们重点看<code>bind</code>和<code>make</code>函数。首先我们看<code>bind</code>函数:</p>

</div><div id="wmd-preview-section-11144" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="hljs xquery"><span class="hljs-comment line-number">1.</span> public <span class="hljs-keyword">function</span> bind(<span class="hljs-variable">$abstract</span>, <span class="hljs-variable">$concrete</span> = null, <span class="hljs-variable">$shared</span> = <span class="hljs-literal">false</span>)<br><span class="hljs-comment line-number">2.</span>    {<br><span class="hljs-comment line-number">3.</span>               <span class="hljs-variable">$abstract</span> = <span class="hljs-variable">$this-</span>&gt;normalize(<span class="hljs-variable">$abstract</span>);<br><span class="hljs-comment line-number">4.</span><br><span class="hljs-comment line-number">5.</span>        <span class="hljs-variable">$concrete</span> = <span class="hljs-variable">$this-</span>&gt;normalize(<span class="hljs-variable">$concrete</span>);<br><span class="hljs-comment line-number">6.</span><br><span class="hljs-comment line-number">7.</span>        if (is_array(<span class="hljs-variable">$abstract</span>)) {<br><span class="hljs-comment line-number">8.</span>            list(<span class="hljs-variable">$abstract</span>, <span class="hljs-variable">$alias</span>) = <span class="hljs-variable">$this-</span>&gt;extractAlias(<span class="hljs-variable">$abstract</span>);<br><span class="hljs-comment line-number">9.</span><br><span class="hljs-comment line-number">10.</span>            <span class="hljs-variable">$this-</span>&gt;alias(<span class="hljs-variable">$abstract</span>, <span class="hljs-variable">$alias</span>);<br><span class="hljs-comment line-number">11.</span>        }         <span class="hljs-variable">$this-</span>&gt;dropStaleInstances(<span class="hljs-variable">$abstract</span>);<br><span class="hljs-comment line-number">12.</span><br><span class="hljs-comment line-number">13.</span>        if (is_null(<span class="hljs-variable">$concrete</span>)) {<br><span class="hljs-comment line-number">14.</span>            <span class="hljs-variable">$concrete</span> = <span class="hljs-variable">$abstract</span>;<br><span class="hljs-comment line-number">15.</span>        } <br><span class="hljs-comment line-number">16.</span><br><span class="hljs-comment line-number">17.</span>        if (! <span class="hljs-variable">$concrete</span> instanceof Closure) {<br><span class="hljs-comment line-number">18.</span>            <span class="hljs-variable">$concrete</span> = <span class="hljs-variable">$this-</span>&gt;getClosure(<span class="hljs-variable">$abstract</span>, <span class="hljs-variable">$concrete</span>);<br><span class="hljs-comment line-number">19.</span>        }<br><span class="hljs-comment line-number">20.</span>        //以上都不看，都是在做一些准备工作<br><span class="hljs-comment line-number">21.</span>        //到这里，把我们注册的生产脚本给存储起来,就这样结束了。<br><span class="hljs-comment line-number">22.</span>        //接下来我们就可以make了<br><span class="hljs-comment line-number">23.</span>        <span class="hljs-variable">$this-</span>&gt;bindings[<span class="hljs-variable">$abstract</span>] = compact(<span class="hljs-string">'concrete'</span>, <span class="hljs-string">'shared'</span>);<br><span class="hljs-comment line-number">24.</span>        if (<span class="hljs-variable">$this-</span>&gt;resolved(<span class="hljs-variable">$abstract</span>)) {<br><span class="hljs-comment line-number">25.</span>            <span class="hljs-variable">$this-</span>&gt;rebound(<span class="hljs-variable">$abstract</span>);<br><span class="hljs-comment line-number">26.</span>        }<br><span class="hljs-comment line-number">27.</span>    }<br></code></pre>

<p>回到上面在看我们写的代码，是不是调用了<code>bind</code>函数，传递了一个商品名<code>App\Libraries\MyClass</code>和一个匿名函数。后面我们就使用了这个商品名创建出了商品，我们再来看<code>make</code>函数</p>

</div><div id="wmd-preview-section-11145" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="hljs xquery"><span class="hljs-comment line-number">1.</span> public <span class="hljs-keyword">function</span> make(<span class="hljs-variable">$abstract</span>, <span class="hljs-keyword">array</span> <span class="hljs-variable">$parameters</span> = [])<br><span class="hljs-comment line-number">2.</span>    {<br><span class="hljs-comment line-number">3.</span>        <span class="hljs-variable">$abstract</span> = <span class="hljs-variable">$this-</span>&gt;getAlias(<span class="hljs-variable">$this-</span>&gt;normalize(<span class="hljs-variable">$abstract</span>));<br><span class="hljs-comment line-number">4.</span><br><span class="hljs-comment line-number">5.</span><br><span class="hljs-comment line-number">6.</span>        //如果是单列，则直接返回<br><span class="hljs-comment line-number">7.</span>        if (isset(<span class="hljs-variable">$this-</span>&gt;instances[<span class="hljs-variable">$abstract</span>])) {<br><span class="hljs-comment line-number">8.</span>            return <span class="hljs-variable">$this-</span>&gt;instances[<span class="hljs-variable">$abstract</span>];<br><span class="hljs-comment line-number">9.</span>        }<br><span class="hljs-comment line-number">10.</span><br><span class="hljs-comment line-number">11.</span>        //获取匿名函数 <br><span class="hljs-comment line-number">12.</span>        //判断商品是否可以被制造<br><span class="hljs-comment line-number">13.</span>        if (<span class="hljs-variable">$this-</span>&gt;isBuildable(<span class="hljs-variable">$concrete</span>, <span class="hljs-variable">$abstract</span>)) {<br><span class="hljs-comment line-number">14.</span>            //开始真正制造商品了。这里调用了我们写的匿名函数，<span class="hljs-variable">$parameters</span>是make()   的第二个参数，会被传递到A里面。进行变量的初始化，这样对于MyClass来说，依赖关系就可以通过外部指定、比如Mysql依赖User类的对象。就可以在这个时候传递进去。<br><span class="hljs-comment line-number">15.</span>            <span class="hljs-variable">$object</span> = <span class="hljs-variable">$this-</span>&gt;build(<span class="hljs-variable">$concrete</span>, <span class="hljs-variable">$parameters</span>);<br><span class="hljs-comment line-number">16.</span>        } else {<br><span class="hljs-comment line-number">17.</span>            <span class="hljs-variable">$object</span> = <span class="hljs-variable">$this-</span>&gt;make(<span class="hljs-variable">$concrete</span>, <span class="hljs-variable">$parameters</span>);<br><span class="hljs-comment line-number">18.</span>        } <br><span class="hljs-comment line-number">19.</span><br><span class="hljs-comment line-number">20.</span>        foreach (<span class="hljs-variable">$this-</span>&gt;getExtenders(<span class="hljs-variable">$abstract</span>) as <span class="hljs-variable">$extender</span>) {<br><span class="hljs-comment line-number">21.</span>            <span class="hljs-variable">$object</span> = <span class="hljs-variable">$extender</span>(<span class="hljs-variable">$object</span>, <span class="hljs-variable">$this</span>);<br><span class="hljs-comment line-number">22.</span>        }<br><span class="hljs-comment line-number">23.</span><br><span class="hljs-comment line-number">24.</span>        //如果是单列，则存储到<span class="hljs-variable">$instances</span>数组中，方便下次直接使用<br><span class="hljs-comment line-number">25.</span>        if (<span class="hljs-variable">$this-</span>&gt;isShared(<span class="hljs-variable">$abstract</span>)) {<br><span class="hljs-comment line-number">26.</span>            <span class="hljs-variable">$this-</span>&gt;instances[<span class="hljs-variable">$abstract</span>] = <span class="hljs-variable">$object</span>;<br><span class="hljs-comment line-number">27.</span>        }<br><span class="hljs-comment line-number">28.</span><br><span class="hljs-comment line-number">29.</span>        <span class="hljs-variable">$this-</span>&gt;fireResolvingCallbacks(<span class="hljs-variable">$abstract</span>, <span class="hljs-variable">$object</span>);<br><span class="hljs-comment line-number">30.</span>        //记录为已经被处理<br><span class="hljs-comment line-number">31.</span>        <span class="hljs-variable">$this-</span>&gt;resolved[<span class="hljs-variable">$abstract</span>] = true;<br><span class="hljs-comment line-number">32.</span>        //最后返回这个对象<br><span class="hljs-comment line-number">33.</span>        return <span class="hljs-variable">$object</span>;<br><span class="hljs-comment line-number">34.</span>    }<br></code></pre>

<p>再回过头看看，是不是明白了我们是怎么通过调用<code>make</code>得到了<code>MyClass</code>对象的。是的、没错整个<code>make</code>函数就做了一件事情，那就是把我们注册的匿名函数运行一下。得到一个对象并把它返回给我们。</p>

<p>到这里就差不多了。对于我们对象是怎么创建的我们已经有了直观的理解。但是我还想知道。我们写的<code>register</code>函数是在什么时候被外部调用的。这个就涉及到Laravel的启动流程了。 <br>
1.主入口文件<code>index.php</code>.众所周知，一个请求一定是从<code>public/index.php</code>开始的。</p>

</div><div id="wmd-preview-section-11146" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="hljs xquery"><span class="hljs-comment line-number">1.</span>&lt;?php<br><span class="hljs-comment line-number">2.</span>//这个不看，就在了composer的东西<br><span class="hljs-comment line-number">3.</span>require __DIR_<span class="hljs-number">_</span>.<span class="hljs-string">'/../bootstrap/autoload.php'</span>;<br><span class="hljs-comment line-number">4.</span>//干了意见事情，new了一个Applicton类的对象，初始化了一个IOC容器，后面一直会使用。<br><span class="hljs-comment line-number">5.</span><span class="hljs-variable">$app</span> = require_once __DIR_<span class="hljs-number">_</span>.<span class="hljs-string">'/../bootstrap/app.php'</span>;<br><span class="hljs-comment line-number">6.</span>//通过服务容器生成一个kernel类的实例（Illuminate\Contracts\Http\Kernel实际上只是一个接口，真正生成的实例是App\Http\Kernel类，至于怎么把接口和类关联起来，请查看Contracts相关文档）<br><span class="hljs-comment line-number">7.</span><span class="hljs-variable">$kernel</span> = <span class="hljs-variable">$app-</span>&gt;make(Illuminate\Contracts\Http\Kernel::class);<br><span class="hljs-comment line-number">8.</span><span class="hljs-variable">$request</span> = Illuminate\Http\Request::capture();<br><span class="hljs-comment line-number">9.</span>//重点在这里，我们去看handle函数<br><span class="hljs-comment line-number">10.</span><span class="hljs-variable">$response</span> = <span class="hljs-variable">$kernel-</span>&gt;handle(<span class="hljs-variable">$request</span>);<br><span class="hljs-comment line-number">11.</span><br><span class="hljs-comment line-number">12.</span><span class="hljs-variable">$response-</span>&gt;send();<br><span class="hljs-comment line-number">13.</span><br><span class="hljs-comment line-number">14.</span><span class="hljs-variable">$kernel-</span>&gt;terminate(<span class="hljs-variable">$request</span>, <span class="hljs-variable">$response</span>);<br></code></pre>

<p>接下来我们去看<code>handle</code>方法，它在<code>vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php</code>文件里</p>

</div><div id="wmd-preview-section-11147" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="hljs xquery"><span class="hljs-comment line-number">1.</span> public <span class="hljs-keyword">function</span> handle(<span class="hljs-variable">$request</span>)<br><span class="hljs-comment line-number">2.</span>    {<br><span class="hljs-comment line-number">3.</span>        try {<br><span class="hljs-comment line-number">4.</span>            <span class="hljs-variable">$request-</span>&gt;enableHttpMethodParameterOverride();<br><span class="hljs-comment line-number">5.</span>            //重点，继续去查<br><span class="hljs-comment line-number">6.</span>            <span class="hljs-variable">$response</span> = <span class="hljs-variable">$this-</span>&gt;sendRequestThroughRouter(<span class="hljs-variable">$request</span>);<br><span class="hljs-comment line-number">7.</span>        } catch (Exception <span class="hljs-variable">$e</span>) {<br><span class="hljs-comment line-number">8.</span>            <span class="hljs-variable">$this-</span>&gt;reportException(<span class="hljs-variable">$e</span>);<br><span class="hljs-comment line-number">9.</span><br><span class="hljs-comment line-number">10.</span>            <span class="hljs-variable">$response</span> = <span class="hljs-variable">$this-</span>&gt;renderException(<span class="hljs-variable">$request</span>, <span class="hljs-variable">$e</span>);<br><span class="hljs-comment line-number">11.</span>        } catch (Throwable <span class="hljs-variable">$e</span>) {<br><span class="hljs-comment line-number">12.</span>            <span class="hljs-variable">$this-</span>&gt;reportException(<span class="hljs-variable">$e</span> = new FatalThrowableError(<span class="hljs-variable">$e</span>));<br><span class="hljs-comment line-number">13.</span><br><span class="hljs-comment line-number">14.</span>            <span class="hljs-variable">$response</span> = <span class="hljs-variable">$this-</span>&gt;renderException(<span class="hljs-variable">$request</span>, <span class="hljs-variable">$e</span>);<br><span class="hljs-comment line-number">15.</span>        }<br><span class="hljs-comment line-number">16.</span><br><span class="hljs-comment line-number">17.</span>        <span class="hljs-variable">$this-</span>&gt;app[<span class="hljs-string">'events'</span>]-&gt;fire(<span class="hljs-string">'kernel.handled'</span>, [<span class="hljs-variable">$request</span>, <span class="hljs-variable">$response</span>]);<br><span class="hljs-comment line-number">18.</span><br><span class="hljs-comment line-number">19.</span>        return <span class="hljs-variable">$response</span>;<br><span class="hljs-comment line-number">20.</span>    }<br><span class="hljs-comment line-number">21.</span><br><span class="hljs-comment line-number">22.</span> protected <span class="hljs-keyword">function</span> sendRequestThroughRouter(<span class="hljs-variable">$request</span>)<br><span class="hljs-comment line-number">23.</span>    {<br><span class="hljs-comment line-number">24.</span>        <span class="hljs-variable">$this-</span>&gt;app-&gt;instance(<span class="hljs-string">'request'</span>, <span class="hljs-variable">$request</span>);<br><span class="hljs-comment line-number">25.</span><br><span class="hljs-comment line-number">26.</span>        Facade::clearResolvedInstance(<span class="hljs-string">'request'</span>);<br><span class="hljs-comment line-number">27.</span>        //初始化工作，会加载很多内容，比如路由、服务提供者等。都定义在<span class="hljs-variable">$bootstrappers</span>数组里。这里是服务器提供者触发的起始点。<br><span class="hljs-comment line-number">28.</span>        <span class="hljs-variable">$this-</span>&gt;bootstrap();<br><span class="hljs-comment line-number">29.</span><br><span class="hljs-comment line-number">30.</span>        return (new Pipeline(<span class="hljs-variable">$this-</span>&gt;app))<br><span class="hljs-comment line-number">31.</span>                    -&gt;send(<span class="hljs-variable">$request</span>)<br><span class="hljs-comment line-number">32.</span>                    -&gt;through(<span class="hljs-variable">$this-</span>&gt;app-&gt;shouldSkipMiddleware() ? [] : <span class="hljs-variable">$this-</span>&gt;middleware)<br><span class="hljs-comment line-number">33.</span>                    -&gt;then(<span class="hljs-variable">$this-</span>&gt;dispatchToRouter());<br><span class="hljs-comment line-number">34.</span>    }<br></code></pre>

<p>如果我们在去往下追踪，会得到这样一个运行路线:</p>

</div><div id="wmd-preview-section-11148" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="hljs stylus"><span class="hljs-comment line-number">1.</span>做一些引导工作，把Illuminate\Foundation\Bootstrap目录下定义的内容统统加载进来。RegisterProviders.php就被定义该目录下。所以这里触发了服务提供者的加载工作。<br><span class="hljs-comment line-number">2.</span>vendor/laravel/framework/src/Illuminate/Foundation/Application<span class="hljs-class">.php</span><span class="hljs-class">.Illuminate</span>\Foundation\Application-&gt;<span class="hljs-function"><span class="hljs-title">bootstrapWith</span><span class="hljs-params">()</span></span>: lineno <span class="hljs-number">205</span>   <br><span class="hljs-comment line-number">3.</span><br><span class="hljs-comment line-number">4.</span>注册服务器提供者，什么都没干，调用了一下Appliction的registerConfiguredProviders函数。<br><span class="hljs-comment line-number">5.</span>vendor/laravel/framework/src/Illuminate/Foundation/Bootstrap/RegisterProviders<span class="hljs-class">.php</span><span class="hljs-class">.Illuminate</span>\Foundation\Bootstrap\RegisterProviders-&gt;<span class="hljs-function"><span class="hljs-title">bootstrap</span><span class="hljs-params">()</span></span>: lineno <span class="hljs-number">18</span>    <br><span class="hljs-comment line-number">6.</span><br><span class="hljs-comment line-number">7.</span>构建ProviderRepository对象，调用对象的load函数，注册config中定义的所有服务器提供者<br><span class="hljs-comment line-number">8.</span>vendor/laravel/framework/src/Illuminate/Foundation/Application<span class="hljs-class">.php</span><span class="hljs-class">.Illuminate</span>\Foundation\Application-&gt;<span class="hljs-function"><span class="hljs-title">registerConfiguredProviders</span><span class="hljs-params">()</span></span>: lineno <span class="hljs-number">508</span> <br><span class="hljs-comment line-number">9.</span><br><span class="hljs-comment line-number">10.</span><br><span class="hljs-comment line-number">11.</span>注册所有的服务器提供者到appliction中<br><span class="hljs-comment line-number">12.</span>vendor/laravel/framework/src/Illuminate/Foundation/ProviderRepository<span class="hljs-class">.php</span><span class="hljs-class">.Illuminate</span>\Foundation\ProviderRepository-&gt;<span class="hljs-function"><span class="hljs-title">load</span><span class="hljs-params">()</span></span>: lineno <span class="hljs-number">77</span>   <br><span class="hljs-comment line-number">13.</span><br><span class="hljs-comment line-number">14.</span>把具体的Provider注册到appliction中，比如我们定义的App\\Providers\\MyClassService，这个时候就会调用该类的register函数了。<br><span class="hljs-comment line-number">15.</span>vendor/laravel/framework/src/Illuminate/Foundation/Application<span class="hljs-class">.php</span><span class="hljs-class">.Illuminate</span>\Foundation\Application-&gt;<span class="hljs-function"><span class="hljs-title">register</span><span class="hljs-params">()</span></span>: lineno <span class="hljs-number">536</span><br></code></pre>

</div><div id="wmd-preview-section-11149" class="wmd-preview-section preview-content">

<h4 id="结束">结束</h4>

<p>重点阅读了IOC的实现部分。后面关于<code>register</code>函数的调用。只是粗略的追踪了下调用的堆栈。不足之处望见谅。至此，文章就结束了。接下我来会按照上述步骤写一篇关于<code>Facade</code>的内容。请求期待。</p>

</div><div id="wmd-preview-section-11150" class="wmd-preview-section preview-content">

<h4 id="资源">资源</h4>

<p>1.<a href="http://www.cnblogs.com/wish123/p/4756669.html" target="_blank">laravel的启动过程</a> <br>
2.<a href="http://www.cnblogs.com/xdp-gacl/p/4249939.html" target="_blank">谈谈对Spring IOC的理解</a> <br>
3.<a href="https://www.insp.top/learn-laravel-container" target="_blank">laravel 学习笔记 —— 神奇的服务容器</a></p>

</div><div id="wmd-preview-section-11151" class="wmd-preview-section preview-content"></div><div id="wmd-preview-section-footnotes" class="preview-content"></div></div></body></html>